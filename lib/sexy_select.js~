var checkbox_select_methods = {
	setDOMAttribute: function(element, attr, value){
		element = $(element);
		eval("element." + attr + "=" + value + ";");
		return element;
	},
	
	getDOMAttribute: function(element, attr){
		element = $(element);
		return eval("element." + attr + ";");
	}
}

Element.addMethods(checkbox_select_methods);

function checkbox_select_toggle(id)  {
	$(id).checked = ($(id).checked == true ? false : true);
}

function checkbox_select_counter(id) {
        var counter = 0;
        $$("input[id^='"+id+"']").map(function(e) { return (e.checked ? 1 : 0); }).each(function(e) { counter += e;}); 
        return counter;
}

function checkbox_select_rewrite_title_with_count(id, nouns, title, current_count) {
        element = $(id+"-header");
        if(title && current_count == 0) {
          element.innerHTML = title;
        } else {
          element.innerHTML = current_count.toString()+" "+(current_count == 1 ? nouns[0] : nouns[1])+" Selected";
        }
}

function checkbox_select_toggle_then_change_count(id, cat_id, nouns) {
        checkbox_select_toggle_then_change_count_with_title(id, cat_id, nouns, false);
}

function checkbox_select_toggle_then_change_count_with_title(id, cat_id, nouns, title) {
        checkbox_select_toggle(id+"-"+cat_id);
        checkbox_select_change_count_with_title(id, nouns, title);
}

function checkbox_select_change_count_with_title(id, nouns, title) {
        checkbox_select_rewrite_title_with_count(id, nouns, title, checkbox_select_counter(id));
}

function checkbox_select_change_count(id, nouns) {
        checkbox_select_change_count_with_title(id, nouns, false);
}

function checkbox_select_main_toggle(id) {
	$(id).style.display = ($(id).style.display == 'block' ? 'none' : 'block')
}

function checkbox_select_setup(id) {
	document.observe('dom:loaded', function() {
		checkbox_select_offclick_observer(id);
	});
}

function checkbox_select_offclick_observer(id) {
	document.observe('click', function(event){
		element = $(id+"-main");
		ignore = $(id+"-header");
		if (element.visible() && !event.target.descendantOf(element) && event.target != element && event.target != ignore) {
			element.hide();
		}
	});
}
